<% if notice %>
  <div class="flash-notice"><%= notice %></div>
<% end %>

<div class="breadcrumb">
  <%= link_to "← Back to Categories", categories_path, class: "back-link" %>
</div>

<div class="page-header">
  <h1><%= @category.name %></h1>
  <% if @category.description.present? %>
    <p><%= @category.description %></p>
  <% end %>

  <div class="action-buttons">
    <%= link_to "✏️ Edit Category", edit_category_path(@category), class: "btn btn-secondary" %>
    <%= link_to "🗑️ Delete Category", category_path(@category), method: :delete,
        confirm: "Are you sure? This will remove the category from all #{pluralize(@category.items.count, 'item')}.",
        class: "btn btn-danger" %>
  </div>
</div>

<div class="category-stats">
  <div class="stat-card">
    <h3><%= @category.items.count %></h3>
    <p>Total Items</p>
  </div>
  <div class="stat-card">
    <h3><%= @category.items.joins(:inventory_items).sum(:quantity) %></h3>
    <p>Total Quantity in Stock</p>
  </div>
  <div class="stat-card">
    <h3><%= @category.items.joins(:inventory_items).select(:location_id).distinct.count %></h3>
    <p>Locations</p>
  </div>
</div>

<div class="items-in-category">
  <h2>Items in this Category</h2>

  <% if @items.any? %>
    <div class="items-table">
      <table>
        <thead>
          <tr>
            <th>Item Name</th>
            <th>Barcode</th>
            <th>Total Quantity</th>
            <th>Locations</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @items.each do |item| %>
            <tr>
              <td>
                <%= link_to item.name, item_path(item.barcode), class: "item-link" %>
                <% if item.description.present? %>
                  <br><small class="description"><%= item.description %></small>
                <% end %>
              </td>
              <td class="barcode"><%= item.barcode %></td>
              <td class="quantity"><%= item.total_quantity %></td>
              <td class="locations">
                <% if item.locations.any? %>
                  <%= item.locations.map(&:name).join(", ") %>
                <% else %>
                  <span class="no-locations">Not in any fridge</span>
                <% end %>
              </td>
              <td class="actions">
                <%= link_to "View", item_path(item.barcode), class: "btn btn-sm btn-primary" %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    <div class="empty-state">
      <h3>No items in this category</h3>
      <p>No items have been assigned to this category yet.</p>
      <%= link_to "Browse all items", items_path, class: "btn btn-primary" %>
    </div>
  <% end %>
</div>

<style>
.category-stats {
  display: flex;
  gap: 20px;
  margin: 20px 0;
}

.stat-card {
  background: #f8f9fa;
  padding: 20px;
  border-radius: 8px;
  text-align: center;
  flex: 1;
}

.stat-card h3 {
  margin: 0 0 10px 0;
  font-size: 2em;
  color: #007bff;
}

.stat-card p {
  margin: 0;
  color: #6c757d;
  font-size: 0.9em;
}

.items-in-category {
  margin-top: 30px;
}
</style>