<% if notice %>
  <div class="flash-notice"><%= notice %></div>
<% end %>

<div class="breadcrumb">
  <%= link_to t('navigation.back_to', resource: t('categories.title')), categories_path, class: "back-link" %>
</div>

<div class="page-header">
  <h1><%= @category.name %></h1>
  <% if @category.description.present? %>
    <p><%= @category.description %></p>
  <% end %>

  <div class="action-buttons">
    <%= link_to "✏️ #{t('navigation.edit', resource: t('categories.title').singularize)}", edit_category_path(@category), class: "btn btn-secondary" %>
    <%= link_to "🗑️ #{t('navigation.delete', resource: t('categories.title').singularize)}", category_path(@category), method: :delete,
        confirm: "#{t('common.confirm')} #{t('categories.delete_warning', count: @category.items.count)}",
        class: "btn btn-danger" %>
  </div>
</div>

<div class="category-stats">
  <div class="stat-card">
    <h3><%= @category.items.count %></h3>
    <p><%= t('categories.total_items') %></p>
  </div>
  <div class="stat-card">
    <h3><%= @category.items.joins(:inventory_items).sum(:quantity) %></h3>
    <p><%= t('categories.total_quantity_in_stock') %></p>
  </div>
  <div class="stat-card">
    <h3><%= @category.items.joins(:inventory_items).select(:location_id).distinct.count %></h3>
    <p><%= t('items.locations') %></p>
  </div>
</div>

<div class="items-in-category">
  <h2><%= t('categories.items_in_category') %></h2>

  <% if @items.any? %>
    <div class="items-table">
      <table>
        <thead>
          <tr>
            <th><%= t('items.item_name') %></th>
            <th><%= t('items.barcode') %></th>
            <th><%= t('items.total_quantity') %></th>
            <th><%= t('items.locations') %></th>
            <th><%= t('common.actions') %></th>
          </tr>
        </thead>
        <tbody>
          <% @items.each do |item| %>
            <tr>
              <td>
                <%= link_to item.name, item_path(item.barcode), class: "item-link" %>
                <% if item.description.present? %>
                  <br><small class="description"><%= item.description %></small>
                <% end %>
              </td>
              <td class="barcode"><%= item.barcode %></td>
              <td class="quantity"><%= item.total_quantity %></td>
              <td class="locations">
                <% if item.locations.any? %>
                  <%= item.locations.map(&:name).join(", ") %>
                <% else %>
                  <span class="no-locations"><%= t('dashboard.not_in_any', location: location_term.downcase) %></span>
                <% end %>
              </td>
              <td class="actions">
                <%= link_to t('navigation.view'), item_path(item.barcode), class: "btn btn-sm btn-primary" %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    <div class="empty-state">
      <h3><%= t('categories.no_items_in_category') %></h3>
      <p><%= t('categories.no_items_in_category_message') %></p>
      <%= link_to t('categories.browse_all_items'), items_path, class: "btn btn-primary" %>
    </div>
  <% end %>
</div>

<style>
.category-stats {
  display: flex;
  gap: 20px;
  margin: 20px 0;
}

.stat-card {
  background: #f8f9fa;
  padding: 20px;
  border-radius: 8px;
  text-align: center;
  flex: 1;
}

.stat-card h3 {
  margin: 0 0 10px 0;
  font-size: 2em;
  color: #007bff;
}

.stat-card p {
  margin: 0;
  color: #6c757d;
  font-size: 0.9em;
}

.items-in-category {
  margin-top: 30px;
}
</style>